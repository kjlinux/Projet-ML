================================================================================
X_CLF EMPTY DATAFRAME - ROOT CAUSE & SOLUTION
================================================================================

ISSUE:
======
In Cell 37 (Notebook code cell 30), train_test_split() fails with:
  ValueError: n_samples=0

Because X_clf DataFrame is completely empty (0 rows).

ERROR LOCATION:
===============
File: water_ia_ml_project.ipynb
Cell 30 (Notebook index 36), Line 2-3:

  X_train_clf, X_test_clf, y_train_clf, y_test_clf = train_test_split(
      X_clf, y_clf, test_size=0.2, random_state=42, stratify=y_clf
  )

ROOT CAUSE:
===========
Cell 29 (Notebook index 35) has this code:

  feature_cols_clf = [
      'CUBCONS', 'CUBFAC', 'FORFAIT', 'SOCIAL', 'DOMEST', 'NORMAL', 'INDUST', 'ADMINI',
      'MONT-FDE', 'MONT-TTC', 'MONT-SOD', 'DIAM', 'TENURE_YEARS',
      'DR_ENCODED', 'CEN_ENCODED', 'ENR_ENCODED', 'CATEGORIE_ENCODED', 'P_ENCODED',
      'MM', 'TRIMESTRE', 'NUOVO', 'RESILIE'
  ]
  
  df_classification = df[df['RETARD'].notna()].copy()
  X_clf = df_classification[feature_cols_clf]
  y_clf = df_classification['RETARD']
  
  mask = ~(X_clf.isna().any(axis=1) | y_clf.isna())
  X_clf = X_clf[mask]  <--- THIS FILTERS OUT ALL ROWS
  y_clf = y_clf[mask]

The problem is the final mask operation removes ALL rows because:
- At least one column in feature_cols_clf contains NaN
- The mask keeps only rows with NO NaN in ANY column
- If all rows have NaN in at least one feature, X_clf becomes empty

UNDERLYING CAUSES:
==================

1. RETARD Column Creation (Cell 10):
   df['RETARD'] = ((df['DELAI_REGL'] > 30) | df['DATE-REGLT'].isnull()).astype(int)
   
   Where DELAI_REGL is created by:
   df['DELAI_REGL'] = (df['DATE-REGLT'] - df['DATE-FACT']).dt.days
   
   Issue: If DATE-FACT or DATE-REGLT aren't proper datetime types or have many NaN,
   this produces NaN values that propagate through DELAI_REGL and affect RETARD.

2. Feature NaN Propagation:
   - TENURE_YEARS might have NaN if DATE-ABON is missing
   - Other calculated features might have NaN
   - The strict mask (no NaN in any column) then filters out all rows

3. Missing Datetime Conversion:
   Date columns might not be converted to datetime type in the data loading process,
   causing date arithmetic to fail or produce unexpected results.

COLUMNS INVOLVED (Case Sensitive):
==================================
Original data columns (from Cell 4 COLUMNS list):
  DR, CEN, POLICE, O, P, ENR, MM, AAAA, DATE-FACT, DIAM, CUBCONS, CUBFAC, 
  FORFAIT, SOCIAL, DOMEST, NORMAL, INDUST, ADMINI, MONT-SOD, MONT-TVA, MONT-FDE, 
  MONT-FNE, MONT-ASS-TTC, MONT-FRAIS-CPT, MONT-TTC, DATE-ABON, DATE-RESIL, 
  TOURNEE, DATE-REGLT, AAENC, MMENC, RESILIE, CATEGORIE, NUOVO, DATE-REGLT-ENC

Created columns (Cell 10 - Feature Engineering):
  TENURE_YEARS
  DELAI_REGL
  RETARD        <--- CRITICAL for classification
  ANNEE
  MOIS
  TRIMESTRE
  CUBCONS_PER_DIAM
  AMOUNT_PER_CUB
  IS_RESILIE
  IS_PRIVE

Encoded columns (Cell 12):
  DR_ENCODED
  CEN_ENCODED
  ENR_ENCODED
  CATEGORIE_ENCODED
  P_ENCODED

FIX STRATEGY:
=============

Step 1: Ensure proper datetime conversion (Add before Cell 10)
   
   date_columns = ['DATE-FACT', 'DATE-ABON', 'DATE-REGLT', 'DATE-RESIL', 
                   'TOURNEE', 'DATE-REGLT-ENC']
   
   for col in date_columns:
       if col in df.columns:
           df[col] = pd.to_datetime(df[col], errors='coerce')

Step 2: Add debugging to Cell 29 before the mask:

   # Debug RETARD
   print(f"RETARD non-null: {df['RETARD'].notna().sum()}/{len(df)}")
   print(f"RETARD value counts: {df['RETARD'].value_counts()}")
   
   df_classification = df[df['RETARD'].notna()].copy()
   print(f"Rows after RETARD filter: {len(df_classification)}")
   
   X_clf = df_classification[feature_cols_clf]
   y_clf = df_classification['RETARD']
   
   # Check NaN per column BEFORE mask
   print("\nNaN counts per feature:")
   for col in feature_cols_clf:
       nan_cnt = X_clf[col].isna().sum()
       if nan_cnt > 0:
           print(f"  {col}: {nan_cnt} NaN ({100*nan_cnt/len(X_clf):.1f}%)")
   
   # Check mask impact
   mask = ~(X_clf.isna().any(axis=1) | y_clf.isna())
   print(f"\nRows after mask: {mask.sum()}/{len(X_clf)}")
   
   X_clf = X_clf[mask]
   y_clf = y_clf[mask]

Step 3: If many features have NaN, use fillna instead of filtering:

   # Option A: Fill NaN with median for numeric, mode for categorical
   X_clf = X_clf.fillna(X_clf.median(numeric_only=True))
   
   # Option B: Drop rows with NaN in critical columns only
   critical_cols = ['MONT-FDE', 'CUBCONS', 'TENURE_YEARS', 'RETARD']
   df_classification = df_classification.dropna(subset=critical_cols)
   X_clf = df_classification[feature_cols_clf].fillna(X_clf.median(numeric_only=True))
   y_clf = df_classification['RETARD']

VERIFICATION CHECKLIST:
=======================
[ ] Cell 6 (or early): Convert date columns to datetime
[ ] Cell 10: Verify RETARD is created with data (not all NaN)
[ ] Cell 29: Add debug prints before mask operation
[ ] Cell 29: Fix NaN issue (fill, drop, or handle)
[ ] Cell 30: Verify train_test_split succeeds
[ ] Check: print(df['RETARD'].value_counts()) shows both 0 and 1
[ ] Check: print(df['TENURE_YEARS'].notna().sum()) is close to len(df)

EXPECTED VALUES:
================
After proper fix:
  df['RETARD'].value_counts() should show:
    0    [number of on-time payments]
    1    [number of late payments]
  
  len(df_classification) should be close to len(df) (most rows have RETARD)
  
  X_clf.shape[0] should be > 0 (typically thousands or more rows)
  X_clf.shape[1] should be 21 (number of feature_cols_clf)

FILES REFERENCED:
=================
Water Dataset location: C:\Users\GHOST\Documents\Projet ML\datasets\
  - DR2.txt
  - DR6.txt
  - DR7.txt
  - DR9.txt
  - DR16.txt
  - DR21.txt

Notebook: C:\Users\GHOST\Documents\Projet ML\water_ia_ml_project.ipynb

ABSOLUTE FILE PATHS:
====================
c:\Users\GHOST\Documents\Projet ML\water_ia_ml_project.ipynb
c:\Users\GHOST\Documents\Projet ML\datasets\DR2.txt
c:\Users\GHOST\Documents\Projet ML\datasets\DR6.txt
c:\Users\GHOST\Documents\Projet ML\datasets\DR7.txt
c:\Users\GHOST\Documents\Projet ML\datasets\DR9.txt
c:\Users\GHOST\Documents\Projet ML\datasets\DR16.txt
c:\Users\GHOST\Documents\Projet ML\datasets\DR21.txt

================================================================================
